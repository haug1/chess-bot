var Et=Object.defineProperty;var It=(b,O,C)=>O in b?Et(b,O,{enumerable:!0,configurable:!0,writable:!0,value:C}):b[O]=C;var R=(b,O,C)=>(It(b,typeof O!="symbol"?O+"":O,C),C);(function(){"use strict";function b(){}function O(e){return e()}function C(){return Object.create(null)}function L(e){e.forEach(O)}function We(e){return typeof e=="function"}function G(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function He(e){return Object.keys(e).length===0}function qe(e,...t){if(e==null)return b;const n=e.subscribe(...t);return n.unsubscribe?()=>n.unsubscribe():n}function T(e,t,n){e.$$.on_destroy.push(qe(t,n))}function me(e){return e==null?"":e}function k(e,t){e.appendChild(t)}function v(e,t,n){e.insertBefore(t,n||null)}function p(e){e.parentNode.removeChild(e)}function U(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function j(e){return document.createElement(e)}function Be(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function V(e){return document.createTextNode(e)}function A(){return V(" ")}function Q(){return V("")}function Le(e,t,n,o){return e.addEventListener(t,n,o),()=>e.removeEventListener(t,n,o)}function _(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function je(e){return Array.from(e.childNodes)}function _e(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}let se;function K(e){se=e}const D=[],ye=[],Z=[],be=[],Ke=Promise.resolve();let ie=!1;function De(){ie||(ie=!0,Ke.then(pe))}function le(e){Z.push(e)}const ce=new Set;let X=0;function pe(){const e=se;do{for(;X<D.length;){const t=D[X];X++,K(t),Ye(t.$$)}for(K(null),D.length=0,X=0;ye.length;)ye.pop()();for(let t=0;t<Z.length;t+=1){const n=Z[t];ce.has(n)||(ce.add(n),n())}Z.length=0}while(D.length);for(;be.length;)be.pop()();ie=!1,ce.clear(),K(e)}function Ye(e){if(e.fragment!==null){e.update(),L(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(le)}}const ee=new Set;let x;function P(){x={r:0,c:[],p:x}}function W(){x.r||L(x.c),x=x.p}function d(e,t){e&&e.i&&(ee.delete(e),e.i(t))}function y(e,t,n,o){if(e&&e.o){if(ee.has(e))return;ee.add(e),x.c.push(()=>{ee.delete(e),o&&(n&&e.d(1),o())}),e.o(t)}else o&&o()}function N(e){e&&e.c()}function E(e,t,n,o){const{fragment:s,on_mount:r,on_destroy:l,after_update:f}=e.$$;s&&s.m(t,n),o||le(()=>{const i=r.map(O).filter(We);l?l.push(...i):L(i),e.$$.on_mount=[]}),f.forEach(le)}function I(e,t){const n=e.$$;n.fragment!==null&&(L(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function ze(e,t){e.$$.dirty[0]===-1&&(D.push(e),De(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function Y(e,t,n,o,s,r,l,f=[-1]){const i=se;K(e);const h=e.$$={fragment:null,ctx:null,props:r,update:b,not_equal:s,bound:C(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(i?i.$$.context:[])),callbacks:C(),dirty:f,skip_bound:!1,root:t.target||i.$$.root};l&&l(h.root);let c=!1;if(h.ctx=n?n(e,t.props||{},(a,u,...g)=>{const w=g.length?g[0]:u;return h.ctx&&s(h.ctx[a],h.ctx[a]=w)&&(!h.skip_bound&&h.bound[a]&&h.bound[a](w),c&&ze(e,a)),u}):[],h.update(),c=!0,L(h.before_update),h.fragment=o?o(h.ctx):!1,t.target){if(t.hydrate){const a=je(t.target);h.fragment&&h.fragment.l(a),a.forEach(p)}else h.fragment&&h.fragment.c();t.intro&&d(e.$$.fragment),E(e,t.target,t.anchor,t.customElement),pe()}K(i)}class z{$destroy(){I(this,1),this.$destroy=b}$on(t,n){const o=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return o.push(n),()=>{const s=o.indexOf(n);s!==-1&&o.splice(s,1)}}$set(t){this.$$set&&!He(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}function Je(e){let t;return{c(){t=Be("circle"),_(t,"cx",e[1]),_(t,"cy",e[2]),_(t,"stroke",e[0]),_(t,"opacity","1"),_(t,"r","0.4"),_(t,"stroke-width","0.1"),_(t,"fill","none")},m(n,o){v(n,t,o)},p(n,[o]){o&2&&_(t,"cx",n[1]),o&4&&_(t,"cy",n[2]),o&1&&_(t,"stroke",n[0])},i:b,o:b,d(n){n&&p(t)}}}function Ue(e,t,n){let{color:o}=t,{x:s=0}=t,{y:r=0}=t;return e.$$set=l=>{"color"in l&&n(0,o=l.color),"x"in l&&n(1,s=l.x),"y"in l&&n(2,r=l.y)},[o,s,r]}class te extends z{constructor(t){super(),Y(this,t,Ue,Je,G,{color:0,x:1,y:2})}}const H=[];function J(e,t=b){let n;const o=new Set;function s(f){if(G(e,f)&&(e=f,n)){const i=!H.length;for(const h of o)h[1](),H.push(h,e);if(i){for(let h=0;h<H.length;h+=2)H[h][0](H[h+1]);H.length=0}}}function r(f){s(f(e))}function l(f,i=b){const h=[f,i];return o.add(h),o.size===1&&(n=t(s)||b),f(e),()=>{o.delete(h),o.size===0&&(n(),n=null)}}return{set:s,update:r,subscribe:l}}var m=(e=>(e[e.ERROR=0]="ERROR",e[e.ABORTED=1]="ABORTED",e[e.WAITING_FOR_GAME=2]="WAITING_FOR_GAME",e[e.WAITING_FOR_OPPONENT=3]="WAITING_FOR_OPPONENT",e[e.WAITING_FOR_STOCKFISH=4]="WAITING_FOR_STOCKFISH",e[e.WAITING_FOR_PLAYER=5]="WAITING_FOR_PLAYER",e))(m||{});const ve=J(""),q=J([]),B=J([]),Oe=J(""),$=J(2);function M(e,t){switch(e){case 0:return t===m.WAITING_FOR_STOCKFISH?"rgba(255,255,0,1)":"rgba(0,255,0,1)";case 1:return t===m.WAITING_FOR_STOCKFISH?"rgba(255,255,0,0.5)":"rgba(0,255,0,0.5)";case 2:default:return t===m.WAITING_FOR_STOCKFISH?"rgba(255,255,0,0.3)":"rgba(0,255,0,0.3)"}}function S(e,t){switch(e){case 0:return"rgba(255,0,0,1)";case 1:return"rgba(255,0,0,0.5)";case 2:default:return"rgba(255,0,0,0.3)"}}function we(e,t,n){const o=e.slice();return o[6]=t[n],o[8]=n,o}function Te(e,t,n){const o=e.slice();return o[6]=t[n],o[8]=n,o}function Ee(e){let t,n,o,s=e[3],r=[];for(let c=0;c<s.length;c+=1)r[c]=Ie(Te(e,s,c));const l=c=>y(r[c],1,1,()=>{r[c]=null});let f=e[2],i=[];for(let c=0;c<f.length;c+=1)i[c]=Re(we(e,f,c));const h=c=>y(i[c],1,1,()=>{i[c]=null});return{c(){for(let c=0;c<r.length;c+=1)r[c].c();t=A();for(let c=0;c<i.length;c+=1)i[c].c();n=Q()},m(c,a){for(let u=0;u<r.length;u+=1)r[u].m(c,a);v(c,t,a);for(let u=0;u<i.length;u+=1)i[u].m(c,a);v(c,n,a),o=!0},p(c,a){if(a&9){s=c[3];let u;for(u=0;u<s.length;u+=1){const g=Te(c,s,u);r[u]?(r[u].p(g,a),d(r[u],1)):(r[u]=Ie(g),r[u].c(),d(r[u],1),r[u].m(t.parentNode,t))}for(P(),u=s.length;u<r.length;u+=1)l(u);W()}if(a&5){f=c[2];let u;for(u=0;u<f.length;u+=1){const g=we(c,f,u);i[u]?(i[u].p(g,a),d(i[u],1)):(i[u]=Re(g),i[u].c(),d(i[u],1),i[u].m(n.parentNode,n))}for(P(),u=f.length;u<i.length;u+=1)h(u);W()}},i(c){if(!o){for(let a=0;a<s.length;a+=1)d(r[a]);for(let a=0;a<f.length;a+=1)d(i[a]);o=!0}},o(c){r=r.filter(Boolean);for(let a=0;a<r.length;a+=1)y(r[a]);i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)y(i[a]);o=!1},d(c){U(r,c),c&&p(t),U(i,c),c&&p(n)}}}function Ie(e){let t,n,o,s;return t=new te({props:{color:M(e[8],e[0]),x:e[6].from.x,y:e[6].from.y}}),o=new te({props:{color:M(e[8],e[0]),x:e[6].to.x,y:e[6].to.y}}),{c(){N(t.$$.fragment),n=A(),N(o.$$.fragment)},m(r,l){E(t,r,l),v(r,n,l),E(o,r,l),s=!0},p(r,l){const f={};l&1&&(f.color=M(r[8],r[0])),l&8&&(f.x=r[6].from.x),l&8&&(f.y=r[6].from.y),t.$set(f);const i={};l&1&&(i.color=M(r[8],r[0])),l&8&&(i.x=r[6].to.x),l&8&&(i.y=r[6].to.y),o.$set(i)},i(r){s||(d(t.$$.fragment,r),d(o.$$.fragment,r),s=!0)},o(r){y(t.$$.fragment,r),y(o.$$.fragment,r),s=!1},d(r){I(t,r),r&&p(n),I(o,r)}}}function Re(e){let t,n,o,s;return t=new te({props:{color:S(e[8],e[0]),x:e[6].from.x,y:e[6].from.y}}),o=new te({props:{color:S(e[8],e[0]),x:e[6].to.x,y:e[6].to.y}}),{c(){N(t.$$.fragment),n=A(),N(o.$$.fragment)},m(r,l){E(t,r,l),v(r,n,l),E(o,r,l),s=!0},p(r,l){const f={};l&1&&(f.color=S(r[8],r[0])),l&4&&(f.x=r[6].from.x),l&4&&(f.y=r[6].from.y),t.$set(f);const i={};l&1&&(i.color=S(r[8],r[0])),l&4&&(i.x=r[6].to.x),l&4&&(i.y=r[6].to.y),o.$set(i)},i(r){s||(d(t.$$.fragment,r),d(o.$$.fragment,r),s=!0)},o(r){y(t.$$.fragment,r),y(o.$$.fragment,r),s=!1},d(r){I(t,r),r&&p(n),I(o,r)}}}function Ve(e){let t,n,o=e[1]&&Ee(e);return{c(){o&&o.c(),t=Q()},m(s,r){o&&o.m(s,r),v(s,t,r),n=!0},p(s,[r]){s[1]?o?(o.p(s,r),r&2&&d(o,1)):(o=Ee(s),o.c(),d(o,1),o.m(t.parentNode,t)):o&&(P(),y(o,1,1,()=>{o=null}),W())},i(s){n||(d(o),n=!0)},o(s){y(o),n=!1},d(s){o&&o.d(s),s&&p(t)}}}function ne(e,t,n=!1){const o=parseInt(e.toString());let s;return t?s=n?3.5-o+1:-3.5+o-1:s=n?-3.5+o-1:3.5-o+1,s.toString()}function Ce(e){const t=document.querySelector("coords.files").classList.contains("black");return{from:{x:ne(e.from.x,t,!0),y:ne(e.from.y,t)},to:{x:ne(e.to.x,t,!0),y:ne(e.to.y,t)}}}function Qe(e,t,n){let o,s,r,l,f,i;return T(e,$,h=>n(0,l=h)),T(e,B,h=>n(4,f=h)),T(e,q,h=>n(5,i=h)),e.$$.update=()=>{e.$$.dirty&32&&n(3,o=i.map(h=>Ce(h))),e.$$.dirty&16&&n(2,s=f.map(h=>Ce(h))),e.$$.dirty&1&&n(1,r=l===m.WAITING_FOR_PLAYER||l===m.WAITING_FOR_STOCKFISH)},[l,r,s,o,f,i]}class Ze extends z{constructor(t){super(),Y(this,t,Qe,Ve,G,{})}}async function Xe(e,t){const n=e.getReader();let o;for(;!(o=await n.read()).done;)t(o.value)}function et(e){let t,n,o,s=!1;return function(l){t===void 0?(t=l,n=0,o=-1):t=nt(t,l);const f=t.length;let i=0;for(;n<f;){s&&(t[n]===10&&(i=++n),s=!1);let h=-1;for(;n<f&&h===-1;++n)switch(t[n]){case 58:o===-1&&(o=n-i);break;case 13:s=!0;case 10:h=n;break}if(h===-1)break;e(t.subarray(i,h),o),i=n,o=-1}i===f?t=void 0:i!==0&&(t=t.subarray(i),n-=i)}}function tt(e,t,n){let o=Ae();const s=new TextDecoder;return function(l,f){if(l.length===0)n==null||n(o),o=Ae();else if(f>0){const i=s.decode(l.subarray(0,f)),h=f+(l[f+1]===32?2:1),c=s.decode(l.subarray(h));switch(i){case"data":o.data=o.data?o.data+`
`+c:c;break;case"event":o.event=c;break;case"id":e(o.id=c);break;case"retry":const a=parseInt(c,10);isNaN(a)||t(o.retry=a);break}}}}function nt(e,t){const n=new Uint8Array(e.length+t.length);return n.set(e),n.set(t,e.length),n}function Ae(){return{data:"",event:"",id:"",retry:void 0}}var ot=globalThis&&globalThis.__rest||function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,o=Object.getOwnPropertySymbols(e);s<o.length;s++)t.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(n[o[s]]=e[o[s]]);return n};const ue="text/event-stream",rt=1e3,Ne="last-event-id";function st(e,t){var{signal:n,headers:o,onopen:s,onmessage:r,onclose:l,onerror:f,openWhenHidden:i,fetch:h}=t,c=ot(t,["signal","headers","onopen","onmessage","onclose","onerror","openWhenHidden","fetch"]);return new Promise((a,u)=>{const g=Object.assign({},o);g.accept||(g.accept=ue);let w;function Ge(){w.abort(),document.hidden||ge()}i||document.addEventListener("visibilitychange",Ge);let Pe=rt,ae=0;function he(){document.removeEventListener("visibilitychange",Ge),window.clearTimeout(ae),w.abort()}n==null||n.addEventListener("abort",()=>{he(),u({aborted:!0})});const wt=h!=null?h:window.fetch,Tt=s!=null?s:it;async function ge(){var de;w=new AbortController;try{const re=await wt(e,Object.assign(Object.assign({},c),{headers:g,signal:w.signal}));await Tt(re),await Xe(re.body,et(tt(F=>{F?g[Ne]=F:delete g[Ne]},F=>{Pe=F},r))),l==null||l(),he(),a()}catch(re){if(!w.signal.aborted)try{const F=(de=f==null?void 0:f(re))!==null&&de!==void 0?de:Pe;window.clearTimeout(ae),ae=window.setTimeout(ge,F)}catch(F){he(),u(F)}}}ge()})}function it(e){const t=e.headers.get("content-type");if(!(t!=null&&t.startsWith(ue)))throw new Error(`Expected content-type to be ${ue}, Actual: ${t}`)}class lt{constructor(){R(this,"abortController")}abort(){this.abortController!==void 0&&!this.abortController.signal.aborted&&this.abortController.abort(),this.abortController=void 0}getEvaluation(t,n,o){this.abortController=new AbortController;const s=this.abortController.signal;return new Promise(async(r,l)=>{try{await st("http://localhost:8080/moves/sse",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({moves:t}),signal:s,onmessage(f){const i=JSON.parse(f.data);o({...i,refMoveCounter:n})},onclose(){s.aborted&&l({aborted:!0}),r()},onerror(f){l(f)}})}catch(f){console.log(f),l(f)}})}async getBestMoveBasedOnFEN(t,n){this.abortController=new AbortController;try{return{...await(await fetch("http://localhost:8080/moves",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({moves:t}),signal:this.abortController.signal})).json(),refMoveCounter:n}}catch(o){throw o.name==="AbortError"?{aborted:!0}:o}finally{this.abortController=void 0}}}const Rt="";function ct(e){let t,n,o,s,r,l,f,i,h,c;return{c(){t=j("div"),n=j("span"),o=V(e[2]),s=A(),r=j("span"),l=V(e[0]),f=A(),i=j("button"),i.textContent="Refresh",_(n,"class","svelte-sxmbib"),_(r,"class","svelte-sxmbib"),_(i,"class","svelte-sxmbib"),_(t,"style",e[1]),_(t,"class","svelte-sxmbib")},m(a,u){v(a,t,u),k(t,n),k(n,o),k(t,s),k(t,r),k(r,l),k(t,f),k(t,i),h||(c=Le(i,"click",e[3]),h=!0)},p(a,[u]){u&4&&_e(o,a[2]),u&1&&_e(l,a[0]),u&2&&_(t,"style",a[1])},i:b,o:b,d(a){a&&p(t),h=!1,c()}}}function ut(e,t,n){let o,s,r,l,f,i;T(e,Oe,g=>n(5,l=g)),T(e,$,g=>n(6,f=g)),T(e,ve,g=>n(2,i=g));function h(g){switch(g){case m.ERROR:case m.WAITING_FOR_PLAYER:return"4px";default:return"2px"}}function c(g){switch(g){case m.ERROR:return"red";case m.ABORTED:return"orange";case m.WAITING_FOR_STOCKFISH:return"yellow";case m.WAITING_FOR_PLAYER:return"green";default:return"black"}}function a(g,w){switch(g){case m.ERROR:return"ERROR";case m.ABORTED:return"ABORTED";case m.WAITING_FOR_OPPONENT:return"Waiting for opponent..";case m.WAITING_FOR_STOCKFISH:case m.WAITING_FOR_PLAYER:return w;default:return""}}function u(){fe.resync()}return e.$$.update=()=>{e.$$.dirty&64&&n(4,o={"border-width":h(f),"border-color":c(f)}),e.$$.dirty&16&&n(1,s=Object.keys(o).map(g=>`--${g}:${o[g]}`).join(";")),e.$$.dirty&96&&n(0,r=a(f,l))},[r,s,i,u,o,l,f]}class ft extends z{constructor(t){super(),Y(this,t,ut,ct,G,{})}}const at=(e,t)=>e.from.x!==t.from.x||e.from.y!==t.from.y||e.to.x!==t.to.x||e.to.y!==t.to.y,ht=(e,t)=>e.from.x===t.from.x&&e.from.y===t.from.y&&e.to.x===t.to.x&&e.to.y===t.to.y;class $e{constructor(){R(this,"_stockfish",new lt);R(this,"moveCounter",0);R(this,"moveObserver");R(this,"friendlyMoves");R(this,"enemyMoves");q.subscribe(t=>{console.log({friendlyMoves:t}),this.friendlyMoves=t}),B.subscribe(t=>{console.log({enemyMoves:t}),this.enemyMoves=t})}mount(){new Promise(()=>new this.Highlights({target:this.highlightsTarget})),new Promise(()=>new ft({target:this.statusTarget})),this.onMoveObserved(),this.startObservingMoves()}resync(){this.moveCounter=0,this.moveObserver&&(this.moveObserver.disconnect(),this.moveObserver=void 0),this.onMoveObserved(),this.startObservingMoves()}async onMoveObserved(){++this.moveCounter;try{q.set([]),B.set([]),this._stockfish.abort(),this.moveCounter%2?await this.onPlayerTurn():await this.onOpponentTurn()}catch(t){throw $.set(m.ERROR),t}}startObservingMoves(){this.moveObserver=new MutationObserver(()=>{this.onMoveObserved()}),this.moveObserver.observe(this.movesContainer,{childList:!0,subtree:!0})}async onPlayerTurn(){$.set(m.WAITING_FOR_STOCKFISH);try{await this._stockfish.getEvaluation(this.scrapeMoves(),this.moveCounter,t=>{const n=this.moveCounter!==t.refMoveCounter;if(n)throw{stale:n};Oe.set(t.raw),t.bestmove&&(this.addTopMove(q,t.bestmove.bestmove,this.friendlyMoves),this.addTopMove(B,t.bestmove.ponder,this.enemyMoves)),t.evaluation&&(this.addTopMove(q,t.evaluation.friendly,this.friendlyMoves),t.evaluation.enemy&&this.addTopMove(B,t.evaluation.enemy,this.enemyMoves)),t.score&&ve.set(t.score)}),$.set(m.WAITING_FOR_PLAYER)}catch(t){if(t.stale||t.aborted)$.set(m.ABORTED),this._stockfish.abort();else throw t}}addTopMove(t,n,o){t.set([n,...o.filter(gt(n)).slice(0,1)])}async onOpponentTurn(){$.set(m.WAITING_FOR_OPPONENT)}}function gt(e){return(t,n,o)=>{const s=at(t,e),l=o.findIndex(f=>ht(t,f))===n;return s&&l}}class dt extends $e{constructor(){super(...arguments);R(this,"Highlights",Ze)}get highlightsTarget(){const n=document.querySelector("cg-container svg.cg-shapes g");if(!n)throw new Error("Highlights target not found");return n}get movesContainer(){const n=document.querySelector("l4x");if(!n)throw new Error("Moves container not found");return n}get statusTarget(){const n=document.querySelector(".round__app.variant-standard");if(!n)throw new Error("Status target not found");return n}isGame(){var s;const n=document.querySelector(".message > div:nth-child(1)"),o=n&&((s=n.textContent)==null?void 0:s.includes("It's your turn!"))||!1;return!!document.querySelector("l4x")||o}scrapeMoves(){let n=[];for(const o of document.querySelectorAll("l4x u8t"))o.textContent&&n.push(o.textContent);return n}}const Ct="";function mt(e){let t,n;return{c(){t=j("div"),_(t,"class",n=me(e[0])+" svelte-15mzqdd"),_(t,"style",e[1])},m(o,s){v(o,t,s)},p(o,[s]){s&1&&n!==(n=me(o[0])+" svelte-15mzqdd")&&_(t,"class",n),s&2&&_(t,"style",o[1])},i:b,o:b,d(o){o&&p(t)}}}function _t(e,t,n){let o,s,{color:r}=t,{x:l,y:f}=t;return e.$$set=i=>{"color"in i&&n(2,r=i.color),"x"in i&&n(3,l=i.x),"y"in i&&n(4,f=i.y)},e.$$.update=()=>{e.$$.dirty&4&&n(1,o=`--highlight-color:${r};`),e.$$.dirty&24&&n(0,s=`highlight square-${l}${f}`)},[s,o,r,l,f]}class oe extends z{constructor(t){super(),Y(this,t,_t,mt,G,{color:2,x:3,y:4})}}function Me(e,t,n){const o=e.slice();return o[4]=t[n],o[6]=n,o}function Se(e,t,n){const o=e.slice();return o[7]=t[n],o[6]=n,o}function Fe(e){let t,n,o,s=e[2],r=[];for(let c=0;c<s.length;c+=1)r[c]=ke(Se(e,s,c));const l=c=>y(r[c],1,1,()=>{r[c]=null});let f=e[3],i=[];for(let c=0;c<f.length;c+=1)i[c]=xe(Me(e,f,c));const h=c=>y(i[c],1,1,()=>{i[c]=null});return{c(){for(let c=0;c<r.length;c+=1)r[c].c();t=A();for(let c=0;c<i.length;c+=1)i[c].c();n=Q()},m(c,a){for(let u=0;u<r.length;u+=1)r[u].m(c,a);v(c,t,a);for(let u=0;u<i.length;u+=1)i[u].m(c,a);v(c,n,a),o=!0},p(c,a){if(a&5){s=c[2];let u;for(u=0;u<s.length;u+=1){const g=Se(c,s,u);r[u]?(r[u].p(g,a),d(r[u],1)):(r[u]=ke(g),r[u].c(),d(r[u],1),r[u].m(t.parentNode,t))}for(P(),u=s.length;u<r.length;u+=1)l(u);W()}if(a&9){f=c[3];let u;for(u=0;u<f.length;u+=1){const g=Me(c,f,u);i[u]?(i[u].p(g,a),d(i[u],1)):(i[u]=xe(g),i[u].c(),d(i[u],1),i[u].m(n.parentNode,n))}for(P(),u=f.length;u<i.length;u+=1)h(u);W()}},i(c){if(!o){for(let a=0;a<s.length;a+=1)d(r[a]);for(let a=0;a<f.length;a+=1)d(i[a]);o=!0}},o(c){r=r.filter(Boolean);for(let a=0;a<r.length;a+=1)y(r[a]);i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)y(i[a]);o=!1},d(c){U(r,c),c&&p(t),U(i,c),c&&p(n)}}}function ke(e){let t,n,o,s;return t=new oe({props:{color:M(e[6],e[0]),x:e[7].from.x,y:e[7].from.y}}),o=new oe({props:{color:M(e[6],e[0]),x:e[7].to.x,y:e[7].to.y}}),{c(){N(t.$$.fragment),n=A(),N(o.$$.fragment)},m(r,l){E(t,r,l),v(r,n,l),E(o,r,l),s=!0},p(r,l){const f={};l&1&&(f.color=M(r[6],r[0])),l&4&&(f.x=r[7].from.x),l&4&&(f.y=r[7].from.y),t.$set(f);const i={};l&1&&(i.color=M(r[6],r[0])),l&4&&(i.x=r[7].to.x),l&4&&(i.y=r[7].to.y),o.$set(i)},i(r){s||(d(t.$$.fragment,r),d(o.$$.fragment,r),s=!0)},o(r){y(t.$$.fragment,r),y(o.$$.fragment,r),s=!1},d(r){I(t,r),r&&p(n),I(o,r)}}}function xe(e){let t,n,o,s;return t=new oe({props:{color:S(e[6],e[0]),x:e[4].from.x,y:e[4].from.y}}),o=new oe({props:{color:S(e[6],e[0]),x:e[4].to.x,y:e[4].to.y}}),{c(){N(t.$$.fragment),n=A(),N(o.$$.fragment)},m(r,l){E(t,r,l),v(r,n,l),E(o,r,l),s=!0},p(r,l){const f={};l&1&&(f.color=S(r[6],r[0])),l&8&&(f.x=r[4].from.x),l&8&&(f.y=r[4].from.y),t.$set(f);const i={};l&1&&(i.color=S(r[6],r[0])),l&8&&(i.x=r[4].to.x),l&8&&(i.y=r[4].to.y),o.$set(i)},i(r){s||(d(t.$$.fragment,r),d(o.$$.fragment,r),s=!0)},o(r){y(t.$$.fragment,r),y(o.$$.fragment,r),s=!1},d(r){I(t,r),r&&p(n),I(o,r)}}}function yt(e){let t,n,o=e[1]&&Fe(e);return{c(){o&&o.c(),t=Q()},m(s,r){o&&o.m(s,r),v(s,t,r),n=!0},p(s,[r]){s[1]?o?(o.p(s,r),r&2&&d(o,1)):(o=Fe(s),o.c(),d(o,1),o.m(t.parentNode,t)):o&&(P(),y(o,1,1,()=>{o=null}),W())},i(s){n||(d(o),n=!0)},o(s){y(o),n=!1},d(s){o&&o.d(s),s&&p(t)}}}function bt(e,t,n){let o,s,r,l;return T(e,$,f=>n(0,s=f)),T(e,q,f=>n(2,r=f)),T(e,B,f=>n(3,l=f)),e.$$.update=()=>{e.$$.dirty&1&&n(1,o=s===m.WAITING_FOR_PLAYER||s===m.WAITING_FOR_STOCKFISH)},[s,o,r,l]}class pt extends z{constructor(t){super(),Y(this,t,bt,yt,G,{})}}class vt extends $e{constructor(){super(...arguments);R(this,"Highlights",pt)}get highlightsTarget(){const n=document.querySelector("chess-board");if(!n)throw new Error("Highlights target not found");return n}get movesContainer(){const n=document.querySelector("vertical-move-list");if(!n)throw new Error("Moves container not found");return n}get statusTarget(){const n=document.querySelector(".play-controller-message");if(!n)throw new Error("Status target not found");const o=document.createElement("div");return n.insertBefore(o,n.firstChild),o}isGame(){return!!document.querySelector("vertical-move-list")}scrapeMoves(){let n=[];for(const o of document.querySelectorAll(".move .node"))o.textContent&&n.push(o.textContent);return n}}const fe=window.location.host==="lichess.org"?new dt:new vt,Ot=setInterval(()=>{fe.isGame()&&(clearInterval(Ot),fe.mount())},1e3)})();
